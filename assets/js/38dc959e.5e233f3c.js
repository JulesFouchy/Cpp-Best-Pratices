"use strict";(self.webpackChunkteaching_toolbox_website_generator=self.webpackChunkteaching_toolbox_website_generator||[]).push([[2347],{4137:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=c(n),h=r,m=p["".concat(l,".").concat(h)]||p[h]||d[h]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3136:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(7294),r=n(6010),o={note:a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},a.createElement("path",{fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"})),tip:a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"})),danger:a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},a.createElement("path",{fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"})),info:a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},a.createElement("path",{fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"})),caution:a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},a.createElement("path",{fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))},i={note:"secondary",tip:"success",danger:"danger",info:"info",caution:"warning"};function s(e){var t=e.children,n=e.type,s=e.title,l=void 0===s?n:s,c=e.icon,u=void 0===c?o[n]:c;return a.createElement("div",{className:(0,r.Z)("admonition","admonition-"+n,"alert","alert--"+i[n])},a.createElement("div",{className:"admonition-heading"},a.createElement("h5",null,a.createElement("span",{className:"admonition-icon"},u),l)),a.createElement("div",{className:"admonition-content"},t))}var l=n(7988);function c(e){var t=e.resources;return a.createElement(s,{type:"info",title:"Going Further"},t.map((function(e){return a.createElement("p",null,(0,l.Z)(e))})))}},7988:function(e,t,n){n.d(t,{Z:function(){return r}});var a=n(7294);function r(e){var t=e.title,n=e.author,r=e.link,o=e.duration,i=e.description;return a.createElement("span",null,a.createElement("a",{href:r,target:"_blank"},n,", ",a.createElement("i",null,t)),o&&a.createElement("span",null," (",o,")"),i&&a.createElement("span",null," ",i))}},316:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return u},toc:function(){return d},default:function(){return h}});var a=n(7462),r=n(3366),o=(n(7294),n(4137)),i=n(3136),s=["components"],l={title:"Dependency Injection",benefit:3,easiness:4,level:"practices-and-patterns",tags:["Clean Code"]},c=void 0,u={unversionedId:"lessons/dependency-injection",id:"lessons/dependency-injection",title:"Dependency Injection",description:"Brief",source:"@site/../../content/lessons/dependency-injection.md",sourceDirName:"lessons",slug:"/lessons/dependency-injection",permalink:"/Learn--Clean-Code-With-Cpp/lessons/dependency-injection",tags:[{label:"Clean Code",permalink:"/Learn--Clean-Code-With-Cpp/tags/clean-code"}],version:"current",frontMatter:{title:"Dependency Injection",benefit:3,easiness:4,level:"practices-and-patterns",tags:["Clean Code"]},sidebar:"lessons",previous:{title:"Immediately Invoked Function",permalink:"/Learn--Clean-Code-With-Cpp/lessons/immediately-invoked-function"},next:{title:"Error Handling",permalink:"/Learn--Clean-Code-With-Cpp/lessons/error-handling"}},d=[{value:"Brief",id:"brief",children:[],level:2},{value:"The Singleton attempt",id:"the-singleton-attempt",children:[],level:2},{value:"Dependency Injection",id:"dependency-injection",children:[{value:"Brief",id:"brief-1",children:[],level:3},{value:"When you have no choice but to store the dependency",id:"when-you-have-no-choice-but-to-store-the-dependency",children:[],level:3},{value:"About storing a reference (&amp;)",id:"about-storing-a-reference-",children:[],level:3}],level:2},{value:"Going further",id:"going-further",children:[],level:2}],p={toc:d};function h(e){var t=e.components,n=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h2",{id:"brief"},"Brief"),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Dependency injection")," is a fancy way of saying that adding more parameters to your functions is always the right solution to your problems."),(0,o.kt)("p",null,"Managing dependencies between the different parts of your application is probably the biggest challenge as your codebase grows. Thinking about your architecture carefully, and using dependency injection, can help you handle that complexity."),(0,o.kt)("h2",{id:"the-singleton-attempt"},"The Singleton attempt"),(0,o.kt)("p",null,"One tempting solution would be to resort to the ",(0,o.kt)("em",{parentName:"p"},"Singleton")," (anti-)pattern: make classes that are ",(0,o.kt)("inlineCode",{parentName:"p"},"static")," and therefore available everywhere! It has the advantage that you don't need to pass an instance around (which would probably require you to modify the signature of quite a few fonctions). This makes the Singleton a really good solution ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"in the short term")),"."),(0,o.kt)("p",null,"But the Singleton can end up causing a few problems, hence why most people tend to shy away from it:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It prevents you from having multiple instances of the same class"),". Obviously you are a reasonable person and you use a Singleton only for classes that you need only one single instance of... But you often end up realizing that your assumptions were wrong and that you actually need multiple instances.",(0,o.kt)("br",null),"\nI have a few examples from my personal experience: ",(0,o.kt)("em",{parentName:"li"},"an history")," seems like it is unique across the application, until you realize that having separate histories for separate systems is a useful feature.",(0,o.kt)("br",null),"\nAnd the argument to rule them all: what if you want to have multiple instances of your application in parallel? Then you can't have any static data because it would be shared accross the instancies of your application. For example think of a workspace in a drawing application: you might want to have multiple drawings open at once, each with it's own layer system, history, etc."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It reduces testability"),": each class that depends on a static class cannot be used outside of the application. This is a big problem for testing (and also for reusing your code!). When testing we usually like to create fake instancies of the dependencies of a class to test that class. For example if you depend on a server, it is nice to make your tests with a mock server rather that the production one! The mock server could for example return a dummy answer when you make a request, whithout even having to make an actual web call. This prevents breaking things in production, or even relying on having a server running. Also you can test different scenarios \u2013 like the server beeing down \u2013 whithout having to shut down your actual server! This is also why it is nice to depend on interfaces instead of concrete classes. If you depend on an ",(0,o.kt)("inlineCode",{parentName:"li"},"IServer")," you can then have different test implementations: ",(0,o.kt)("inlineCode",{parentName:"li"},"MockServerRunning"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"MockServerDown"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"MockServerLaggy")," etc."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"It hides dependencies"),". Even though it is a pain to write each dependency explicitly in the signature of functions, later down the road you will be happy to be able to see at a glance what is required for a given function (when refactoring for example). It will also be easier to reuse the code later in other projects if the only dependencies are at the function boundary (aka in the signature).")),(0,o.kt)("h2",{id:"dependency-injection"},"Dependency Injection"),(0,o.kt)("h3",{id:"brief-1"},"Brief"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"So yes, you should receive all the classes that you depend on as parameters to your functions / methods.")),(0,o.kt)("p",null,"Using parameters makes your functions independent of how the outside world is structured, which facilitates change."),(0,o.kt)("p",null,"In the case of a class, receiving the dependencies in the constructor and storing them as members isn't the cleanest solution either, and you should really prefer receiving the dependencies in each method that needs them. This will make clear which parts of your class actually need which dependency."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Also")," if you were to store a reference to the dependency, you would have to make sure that the pointed object outlives the class where the reference is stored; otherwise you would get a dangling reference!",(0,o.kt)("br",null),"\nFor example if your dependency lives in a ",(0,o.kt)("inlineCode",{parentName:"p"},"std::vector"),", and the vector gets resized at some point, all the references to elements of that vector get invalidated! If you stored one such reference, you are in trouble! On the contrary if you pass the reference to the method each time you call it, you will not notice the change of memory address at all."),(0,o.kt)("p",null,"If you end up with too many arguments to your functions because of all the dependencies, maybe grouping them in a struct can be a good idea. Especially because this probably indicates that those dependencies are related and that there is an abstraction waiting to be discovered and reified into a struct or class. This should be considered carefully though because it could lead to introducing unnecessary dependencies: If a class X needs 4 out of the 5 classes packaged in a struct Y, it can be tempting to make X depend on Y, although it will grab one unnecessary dependency, which is ",(0,o.kt)("em",{parentName:"p"},"bad"),". But if you craft your abstractions carefully, everything should be alright and beautiful."),(0,o.kt)("p",null,"To go further, watch ",(0,o.kt)("a",{parentName:"p",href:"https://youtu.be/qkGxy4c64Jg"},(0,o.kt)("em",{parentName:"a"},"Import as an antipattern - Demystifying Dependency Injection in modern Python")),"."),(0,o.kt)("h3",{id:"when-you-have-no-choice-but-to-store-the-dependency"},"When you have no choice but to store the dependency"),(0,o.kt)("p",null,"An interesting exception to the ",(0,o.kt)("em",{parentName:"p"},"do not store your dependencies")," rule is if you need your dependency in the destructor of your class (or in an operator like ",(0,o.kt)("inlineCode",{parentName:"p"},"+="),"): in those cases you cannot pass any arguments because a destructor has no arguments! Therefore you have no other choice but to store the dependency inside the class (or have it global but that would be even worse!)."),(0,o.kt)("p",null,"In such cases",(0,o.kt)("sup",{parentName:"p",id:"fnref-1"},(0,o.kt)("a",{parentName:"sup",href:"#fn-1",className:"footnote-ref"},"1")),", follow the next section's advice and ",(0,o.kt)("em",{parentName:"p"},"avoid storing ",(0,o.kt)("inlineCode",{parentName:"em"},"&"),"s at all cost!")),(0,o.kt)("h3",{id:"about-storing-a-reference-"},"About storing a reference (&)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Never store a ",(0,o.kt)("inlineCode",{parentName:"strong"},"&"),", always store a pointer (",(0,o.kt)("inlineCode",{parentName:"strong"},"*"),") or a ",(0,o.kt)("a",{parentName:"strong",href:"https://en.cppreference.com/w/cpp/utility/functional/reference_wrapper"},(0,o.kt)("inlineCode",{parentName:"a"},"std::reference_wrapper")),".")),(0,o.kt)("p",null,"Storing a reference (",(0,o.kt)("inlineCode",{parentName:"p"},"&"),") is a problem because it makes your type ",(0,o.kt)("strong",{parentName:"p"},"non-copy-assignable"),"! That is because when trying to assign to a refence, you are actually assigning to the object behind the reference! You cannot modify where the reference points to after its creation!"),(0,o.kt)("p",null,"Let's have an example :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-cpp"},"class MyClass {\npublic:\n    // Constructor\n    MyClass(const MyDependency& my_dependency) \n        : _my_dependency{my_dependency} // OK: initializes the reference to point to my_dependency\n    {}\n    // Copy Constructor\n    MyClass(const MyClass& o)\n        : _my_dependency{o._my_dependency} // OK: initializes the reference to point to o.my_dependency\n    {}\n    // Copy Assignment operator\n    MyClass& operator=(const MyClass& o)\n    {\n        _my_dependency = o._my_dependency; // Bad! This doesn't change where the reference is pointing to, but instead tries to modify the object that the reference points to!\n        return *this;\n    }\nprivate:\n    const MyDependency& _my_dependency;\n};\n")),(0,o.kt)("p",null,"Here is ",(0,o.kt)("a",{parentName:"p",href:"https://herbsutter.com/2020/02/"},"a nice article about problems around references by Herb Sutter"),"."),(0,o.kt)("h2",{id:"going-further"},"Going further"),(0,o.kt)(i.Z,{resources:[{title:"Retiring the Singleton Pattern: Concrete Suggestions for What to use Instead",author:"Peter Muldoon",link:"https://youtu.be/K5c7uvWe_hw",duration:"1h",description:"About the Singleton and alternatives to it"},{title:"Breaking Dependencies: The SOLID Principles",author:"Klaus Iglberger",link:"https://youtu.be/Ntraj80qN2k",duration:"1h"}],mdxType:"GoingFurther"}),(0,o.kt)("div",{className:"footnotes"},(0,o.kt)("hr",{parentName:"div"}),(0,o.kt)("ol",{parentName:"div"},(0,o.kt)("li",{parentName:"ol",id:"fn-1"},"I met such a case when creating wrapper classes for Vulkan resources: they need a reference to the device to be destroyed, so I had to store a handle to the device in each wrapper class.",(0,o.kt)("a",{parentName:"li",href:"#fnref-1",className:"footnote-backref"},"\u21a9")))))}h.isMDXComponent=!0}}]);